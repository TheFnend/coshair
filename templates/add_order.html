{% extends "dashboard_base.html" %}

{% block title %}添加订单 - 07妙妙屋{% endblock %}

{% block page_title %}添加订单{% endblock %}

{% block content %}
<style>
:root {
    --primary-color: #2563eb;
    --primary-hover: #1d4ed8;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --danger-color: #ef4444;
    --info-color: #06b6d4;
    --light-bg: #f8fafc;
    --border-color: #e2e8f0;
    --text-muted: #64748b;
    --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.dashboard-card {
    background: white;
    border-radius: 12px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.dashboard-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.card-header-custom {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
    color: white;
    padding: 1.5rem;
    border-radius: 12px 12px 0 0;
    border: none;
}

.card-header-custom h4 {
    margin: 0;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label {
    font-weight: 500;
    color: #374151;
    margin-bottom: 0.5rem;
}

.form-control, .form-select {
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 0.75rem;
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    outline: none;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.btn-secondary {
    background: #6b7280;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: #4b5563;
    transform: translateY(-1px);
}

/* 状态选择器样式 */
.contact-select.qq { background-color: #e3f2fd; border-color: #2196f3; }
.contact-select.wechat { background-color: #e8f5e8; border-color: #4caf50; }
.contact-select.xianyu { background-color: #fff3e0; border-color: #ff9800; }

.deposit-select.paid { background-color: #e8f5e8; border-color: #4caf50; }
.deposit-select.unpaid { background-color: #ffebee; border-color: #f44336; }

.shipping-select.included { background-color: #e8f5e8; border-color: #4caf50; }
.shipping-select.not-included { background-color: #fff3e0; border-color: #ff9800; }

.blank-select.purchased { background-color: #e8f5e8; border-color: #4caf50; }
.blank-select.unpurchased { background-color: #ffebee; border-color: #f44336; }

.cake-box-select.needed { background-color: #e3f2fd; border-color: #2196f3; }
.cake-box-select.not-needed { background-color: #f3e5f5; border-color: #9c27b0; }

.status-select.pending { background-color: #fff3e0; border-color: #ff9800; }
.status-select.in-progress { background-color: #e3f2fd; border-color: #2196f3; }
.status-select.completed { background-color: #e8f5e8; border-color: #4caf50; }
.status-select.shipped { background-color: #e1f5fe; border-color: #00bcd4; }
.status-select.cancelled { background-color: #ffebee; border-color: #f44336; }

.input-group-text {
    background: var(--light-bg);
    border: 2px solid var(--border-color);
    border-right: none;
    color: var(--text-muted);
    font-weight: 500;
}

.text-danger {
    color: var(--danger-color) !important;
}

/* 下拉框选项颜色样式 */
/* 平台选择框选项颜色 */
.contact-select option[value="QQ"] {
    background-color: #e3f2fd !important;
    color: #2196f3 !important;
}
.contact-select option[value="微信"] {
    background-color: #e8f5e8 !important;
    color: #4caf50 !important;
}
.contact-select option[value="闲鱼"] {
    background-color: #fff3e0 !important;
    color: #ff9800 !important;
}

/* 定金状态选项颜色 */
.deposit-select option[value="true"] {
    background-color: #e8f5e8 !important;
    color: #4caf50 !important;
}
.deposit-select option[value="false"] {
    background-color: #ffebee !important;
    color: #f44336 !important;
}

/* 含邮状态选项颜色 */
.shipping-select option[value="true"] {
    background-color: #e8f5e8 !important;
    color: #4caf50 !important;
}
.shipping-select option[value="false"] {
    background-color: #fff3e0 !important;
    color: #ff9800 !important;
}

/* 毛坯状态选项颜色 */
.blank-select option[value="true"] {
    background-color: #e8f5e8 !important;
    color: #4caf50 !important;
}
.blank-select option[value="false"] {
    background-color: #ffebee !important;
    color: #f44336 !important;
}

/* 蛋糕盒选项颜色 */
.cake-box-select option[value="需要"] {
    background-color: #e3f2fd !important;
    color: #2196f3 !important;
}
.cake-box-select option[value="不需要"] {
    background-color: #f3e5f5 !important;
    color: #9c27b0 !important;
}

/* 订单状态选项颜色 */
.status-select option[value="待制作"] {
    background-color: #fff3e0 !important;
    color: #ff9800 !important;
}
.status-select option[value="制作中"] {
    background-color: #e3f2fd !important;
    color: #2196f3 !important;
}
.status-select option[value="已完成"] {
    background-color: #e8f5e8 !important;
    color: #4caf50 !important;
}
.status-select option[value="已发货"] {
    background-color: #e1f5fe !important;
    color: #00bcd4 !important;
}
.status-select option[value="已取消"] {
    background-color: #ffebee !important;
    color: #f44336 !important;
}
</style>

<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="dashboard-card">
            <div class="card-header-custom">
                <h4><i class="bi bi-plus-circle"> 添加新订单</h4>
            </div>
            <div class="card-body" style="padding: 2rem;">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="cn" class="form-label">CN (Coser Name) <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="cn" name="cn" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="character" class="form-label">动漫角色 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="character" name="character" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="contact" class="form-label">平台 <span class="text-danger">*</span></label>
                                <select class="form-select contact-select" id="contact" name="contact" required onchange="updateSelectColors()">
                                    <option value="">请选择平台</option>
                                    <option value="QQ"><i class="fab fa-qq"></i> QQ</option>
                                    <option value="微信"><i class="fab fa-weixin"></i> 微信</option>
                                    <option value="闲鱼"><i class="fas fa-fish"></i> 闲鱼</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="final_amount" class="form-label">尾款金额 <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">¥</span>
                                    <input type="number" class="form-control" id="final_amount" name="final_amount" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="needed_date" class="form-label">客户排单 <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="needed_date" name="needed_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="order_date" class="form-label">ddl <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="order_date" name="order_date" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="deposit_paid" class="form-label">定金状态</label>
                                <select class="form-select deposit-select" id="deposit_paid" name="deposit_paid" onchange="updateSelectColors()">
                                    <option value="false">未付</option>
                                    <option value="true">已付</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="shipping_included" class="form-label">尾款是否含邮</label>
                                <select class="form-select shipping-select" id="shipping_included" name="shipping_included" required onchange="updateSelectColors()">
                                    <option value="false">否</option>
                                    <option value="true">是</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="blank_purchased" class="form-label">毛坯状态</label>
                                <select class="form-select blank-select" id="blank_purchased" name="blank_purchased" onchange="updateSelectColors()">
                                    <option value="false">未购</option>
                                    <option value="true">已购</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="cake_box" class="form-label">蛋糕盒</label>
                                <select class="form-select cake-box-select" id="cake_box" name="cake_box" onchange="updateSelectColors()">
                                    <option value="不需要">不需要</option>
                                    <option value="需要">需要</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="status" class="form-label">订单状态</label>
                                <select class="form-select status-select" id="status" name="status" onchange="updateSelectColors()">
                                    <option value="待制作">待制作</option>
                                    <option value="制作中">制作中</option>
                                    <option value="已完成">已完成</option>
                                    <option value="已发货">已发货</option>
                                    <option value="已取消">已取消</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('dashboard_index') }}" class="btn btn-secondary me-md-2">
                            <i class="bi bi-arrow-left"></i> 返回列表
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> 添加订单
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 更新下拉框颜色
function updateSelectColors() {
    // 定金状态颜色
    document.querySelectorAll('.deposit-select').forEach(select => {
        select.classList.remove('paid', 'unpaid');
        if (select.value === 'true') {
            select.classList.add('paid');
        } else {
            select.classList.add('unpaid');
        }
    });
    
    // 毛坯状态颜色
    document.querySelectorAll('.blank-select').forEach(select => {
        select.classList.remove('purchased', 'unpurchased');
        if (select.value === 'true') {
            select.classList.add('purchased');
        } else {
            select.classList.add('unpurchased');
        }
    });
    
    // 邮费状态颜色
    document.querySelectorAll('.shipping-select').forEach(select => {
        select.classList.remove('included', 'not-included');
        if (select.value === 'true') {
            select.classList.add('included');
        } else {
            select.classList.add('not-included');
        }
    });
    
    // 蛋糕盒状态颜色
    document.querySelectorAll('.cake-box-select').forEach(select => {
        select.classList.remove('needed', 'not-needed');
        if (select.value === '需要') {
            select.classList.add('needed');
        } else {
            select.classList.add('not-needed');
        }
    });
    
    // 制作状态颜色
    document.querySelectorAll('.status-select').forEach(select => {
        select.classList.remove('pending', 'in-progress', 'completed', 'shipped', 'cancelled');
        switch(select.value) {
            case '待制作':
                select.classList.add('pending');
                break;
            case '制作中':
                select.classList.add('in-progress');
                break;
            case '已完成':
                select.classList.add('completed');
                break;
            case '已发货':
                select.classList.add('shipped');
                break;
            case '已取消':
                select.classList.add('cancelled');
                break;
        }
    });
    
    // 平台状态颜色
    document.querySelectorAll('.contact-select').forEach(select => {
        select.classList.remove('qq', 'wechat', 'xianyu');
        switch(select.value) {
            case 'QQ':
                select.classList.add('qq');
                break;
            case '微信':
                select.classList.add('wechat');
                break;
            case '闲鱼':
                select.classList.add('xianyu');
                break;
        }
    });
}

// 设置默认日期为今天
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('order_date').value = today;
    
    // 设置排单的最小值为今天
    document.getElementById('needed_date').min = today;
    
    // 初始化颜色
    updateSelectColors();
});

// 表单验证
document.querySelector('form').addEventListener('submit', function(e) {
    const neededDate = new Date(document.getElementById('needed_date').value);
    const orderDate = new Date(document.getElementById('order_date').value);
    
    // if (neededDate < orderDate) {
    //     e.preventDefault();
    //     alert('客户排单不能早于ddl！');
    //     return false;
    // }
});
</script>
{% endblock %}